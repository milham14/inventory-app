<div class="hold-transition login-page">
    <div class="login-box">
        <div class="login-logo">
          <img src="dist/img/inventory.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-2" style="opacity: .8; width: 200px; height: auto;">
          <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 500;">
            PT RACHMAT PERDANA ADHIMETAL
          </div>
        </div>
        <!-- /.login-logo -->
        <div class="card">
          <div class="card-body login-card-body">
            <p class="login-box-msg">Sign in to start your session</p>
      
            <form (ngSubmit)="onSubmit()" #loginForm="ngForm">
              <div class="input-group mb-3">
                <input type="text" [(ngModel)]="username" name="username" class="form-control" placeholder="Username" required />
                <div class="input-group-append">
                  <div class="input-group-text">
                    <span class="fas fa-user"></span>
                  </div>
                </div>
              </div>
              <div class="input-group mb-3">
                <input type="password" [(ngModel)]="password" name="password" class="form-control" placeholder="Password" required />
                <div class="input-group-append">
                  <div class="input-group-text">
                    <span class="fas fa-lock"></span>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                  <button [disabled]="!loginForm.form.valid" type="submit" class="btn btn-primary btn-block">Login</button>
                </div>
              </div>
              <div *ngIf="errorMessage" class="alert alert-danger mt-2">{{ errorMessage }}</div>
             <!--
              Data Master
               User
               Role
               Permission
               Material
               Parts
               Supplier
               Customer


               import { Injectable, Inject, PLATFORM_ID, NgZone } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { BehaviorSubject, Observable, of, fromEvent, merge } from 'rxjs';
import { catchError, map, tap } from 'rxjs/operators';
import { isPlatformBrowser } from '@angular/common';
import { Router } from '@angular/router';

@Injectable({ providedIn: 'root' })
export class AuthService {
  private intervalId: any;
  private inactivityTimeoutId: any;
  private inactivityTime = 1 * 60 * 1000;
  private apiUrl = 'http://127.0.0.1:8000/api';
  private loggedInSubject: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(this.isLoggedIn());
  loggedIn$ = this.loggedInSubject.asObservable();

  constructor(
    private http: HttpClient,
    @Inject(PLATFORM_ID) private platformId: Object,
    private router: Router,
    private ngZone: NgZone
  ) {
    if (isPlatformBrowser(this.platformId)) {
      this.initInactivityListener();
    }
  }

  login(username: string, password: string) {
    return this.http.post<any>(`${this.apiUrl}/login`, { username, password }).pipe(
      tap(response => {
        if (response.status === 'success') {
          if (isPlatformBrowser(this.platformId)) {
            localStorage.setItem('user', JSON.stringify(response.admin));
            localStorage.setItem('token', response.token);
            localStorage.setItem('login_time', new Date().toString());
          }
          this.loggedInSubject.next(true);
          this.startSessionMonitor();
          this.resetInactivityTimer(); // Reset timer saat login berhasil
        }
      })
    );
  }

  logout() {
    const token = localStorage.getItem('token');
    if (!token) {
      this.clearSession();
      return;
    }

    this.http.post(`${this.apiUrl}/logout`, {}, {
      headers: { 'Authorization': `Bearer ${token}` }
    }).subscribe({
      next: () => this.clearSession(),
      error: () => this.clearSession()
    });
  }

  private clearSession() {
    if (isPlatformBrowser(this.platformId)) {
      localStorage.removeItem('user');
      localStorage.removeItem('token');
      localStorage.removeItem('login_time');
    }

    if (this.intervalId) {
      clearInterval(this.intervalId);
      this.intervalId = null;
    }

    if (this.inactivityTimeoutId) {
      clearTimeout(this.inactivityTimeoutId);
      this.inactivityTimeoutId = null;
    }

    this.loggedInSubject.next(false);
    this.router.navigate(['/login']);
  }

  isLoggedIn(): boolean {
    if (isPlatformBrowser(this.platformId)) {
      return !!localStorage.getItem('user');
    }
    return false;
  }

  getUser() {
    if (isPlatformBrowser(this.platformId)) {
      return JSON.parse(localStorage.getItem('user')!);
    }
    return null;
  }

  private startSessionMonitor() {
    this.intervalId = setInterval(() => {
      this.checkSessionTimeout();
    }, 30000); // setiap 30 detik
  }

  private checkSessionTimeout() {
    const loginTime = localStorage.getItem('login_time');
    if (loginTime) {
      const timePassed = new Date().getTime() - new Date(loginTime).getTime();
      if (timePassed > this.inactivityTime) {
        this.logout();
      }
    }
  }

  public checkTokenValidity(): Observable<boolean> {
    if (typeof window !== 'undefined' && window.localStorage) {
      const token = localStorage.getItem('token');
      if (token) {
        return this.http.get(`${this.apiUrl}/me`, {
          headers: new HttpHeaders().set('Authorization', `Bearer ${token}`)
        }).pipe(
          map(() => true),
          catchError(() => {
            this.clearSession();
            return of(false);
          })
        );
      }
    }
    return of(false);
  }

  private initInactivityListener() {
    this.ngZone.runOutsideAngular(() => {
      const activityEvents = [
        fromEvent(window, 'mousemove'),
        fromEvent(window, 'keydown'),
        fromEvent(window, 'click'),
        fromEvent(window, 'scroll'),
        fromEvent(window, 'touchstart')
      ];

      merge(...activityEvents).subscribe(() => {
        this.resetInactivityTimer();
      });
    });
  }

  private resetInactivityTimer() {
    if (!this.isLoggedIn()) return;

    if (this.inactivityTimeoutId) {
      clearTimeout(this.inactivityTimeoutId);
    }

    this.inactivityTimeoutId = setTimeout(() => {
      console.warn('Tidak ada aktivitas. Melakukan logout otomatis.');
      this.logout();
    }, this.inactivityTime);
  }
}


                <div class="col-8">
                  <div class="icheck-primary">
                    <input type="checkbox" id="remember">
                    <label for="remember">
                      Remember Me
                    </label>
                  </div>
                </div>
             --> <div class="row">
                <!-- /.col 
                 
                <div class="col-12 d-flex justify-content-center">
                  <button type="submit" class="btn btn-primary btn-block">Sign In</button>
                </div>
                
                -->

                <!-- /.col -->
              </div>
            </form>
      

            <!--
                        <div class="social-auth-links text-center mb-3">
              <p>- OR -</p>
              <a href="#" class="btn btn-block btn-primary">
                <i class="fab fa-facebook mr-2"></i> Sign in using Facebook
              </a>
              <a href="#" class="btn btn-block btn-danger">
                <i class="fab fa-google-plus mr-2"></i> Sign in using Google+
              </a>
            </div>
              <p class="mb-1">
              <a href="forgot-password.html">I forgot my password</a>
            </p>
            <p class="mb-0">
              <a href="register.html" class="text-center">Register a new membership</a>
            </p>
            social-auth-links -->
          </div>
          <!-- /.login-card-body -->
        </div>
      </div>
</div>
